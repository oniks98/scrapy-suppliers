# ‚úÖ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è viatec.ua

## üìç –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞
```
https://viatec.ua/product/DS-2CD1321G0-I-28
```

---

## üéØ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

### 1Ô∏è‚É£ **–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**
```python
SELECTOR = "h1::text"
RESULT = "DS-2CD1321G0-I 2–ú–ü (2.8–º–º) IP –≤—ñ–¥–µ–æ–∫–∞–º–µ—Ä–∞ Hikvision"
```

### 2Ô∏è‚É£ **–¶–µ–Ω–∞ (–ö–†–ò–¢–ò–ß–ù–´–ô!)**
```python
SELECTOR = "div.card-header__card-price-new::text"
HTML = '<div class="card-header__card-price-new">2&nbsp;537 <span>–≥—Ä–Ω</span></div>'
RESULT = "2537" (–ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏)
–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –¶–µ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç &nbsp; - —É–¥–∞–ª—è–µ–º, –∑–∞—Ç–µ–º –æ—á–∏—â–∞–µ–º –æ—Ç —Å–∏–º–≤–æ–ª–æ–≤
```

### 3Ô∏è‚É£ **–ö–æ–¥ —Ç–æ–≤–∞—Ä–∞**
```python
# –ù–ï –°–ö–ê–ù–ò–†–£–ï–ú - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏
STRATEGY = "–°—á–µ—Ç—á–∏–∫ –Ω–∞—á–∏–Ω–∞—è —Å 200000, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä"
# –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –º–µ—Ç–æ–¥–µ _generate_product_code()
```

### 4Ô∏è‚É£ **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**
```python
SELECTOR = "img.card-header__card-images-image::attr(src)"
HTML = '<img src="/upload/images/prod/2024-06/DS-2CD1321G0-I.webp" class="card-header__card-images-image">'
RESULT = "/upload/images/prod/2024-06/DS-2CD1321G0-I.webp"
–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: response.urljoin() –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL
```

### 5Ô∏è‚É£ **–û–ø–∏—Å–∞–Ω–∏–µ**
```python
SELECTOR = "div.card-header__card-description p::text"
HTML = '<p>‚óè –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å 2–ú–ü, 1/2.9" CMOS - –º–∞—Ç—Ä–∏—Ü—è;<br>‚óè –§–æ–∫—É—Å 2.8–º–º...</p>'
RESULT = "‚óè –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å 2–ú–ü, 1/2.9\" CMOS - –º–∞—Ç—Ä–∏—Ü—è; ‚óè –§–æ–∫—É—Å 2.8–º–º..."
–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º
```

### 6Ô∏è‚É£ **–ù–∞–ª–∏—á–∏–µ (–ö–†–ò–¢–ò–ß–ù–´–ô!)**
```python
SELECTOR = "div.card-header__card-status-badge::text"
HTML = '<div class="card-header__card-status-badge">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</div>'
RESULT = "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ "–í –Ω–∞–ª–∏—á–∏–∏"
–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –¢–æ–≤–∞—Ä—ã –ü–†–ò –û–¢–°–£–¢–°–¢–í–ò–ò –ù–ï –ó–ê–ü–ò–°–´–í–ê–Æ–¢–°–Ø –≤ CSV
```

### 7Ô∏è‚É£ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å**
```python
STRATEGY = "–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ URL –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –º–∞–ø–ø–∏–Ω–≥ CSV"
EJEMPLO = "https://viatec.ua/catalog/cameras/proizvoditel:hikvision;page:1"
         ‚Üí –ò–∑–≤–ª–µ–∫–∞–µ–º "hikvision" ‚Üí –º–∞–ø–ø–∏—Ä—É–µ–º –≤ "Hikvision"
CSV_FILE = "C:\FullStack\Scrapy\data\manufacturers_viatec.csv"
FALLBACK = –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ (hikvision‚ÜíHikvision, dahua‚ÜíDahua –∏ —Ç.–¥.)
```

### 8Ô∏è‚É£ **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**
```python
SELECTOR = "div.card-tabs__characteristic-content table tbody tr"
HTML = '''<table>
  <tbody>
    <tr>
      <th>–ú–∞—Ç—Ä–∏—Ü—è</th>
      <td>1/2.9" Progressive Scan CMOS</td>
    </tr>
    <tr>
      <th>–®–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞—Ç–≤–æ—Ä–∞</th>
      <td>1/3 - 1/100 000 —Å</td>
    </tr>
  </tbody>
</table>'''
STRATEGY = –ü–∞—Ä—Å–∏–º –∫–∞–∂–¥—ã–π <tr> –∫–∞–∫ (th=–Ω–∞–∑–≤–∞–Ω–∏–µ, td=–∑–Ω–∞—á–µ–Ω–∏–µ), –º–∞–∫—Å 30
```

### 9Ô∏è‚É£ **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**
```python
SELECTOR = "a.paggination__next::attr(href)"
HTML = '<a href="https://viatec.ua/catalog/cameras/proizvoditel:hikvision;page:2" class="paggination__next">‚Üí</a>'
RESULT = "https://viatec.ua/catalog/cameras/proizvoditel:hikvision;page:2"
–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—â–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –±–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â—É—é –∏–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
```

---

## üìã –°—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã (—Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤)
```python
SELECTOR = "a[href*='/product/']::attr(href)"
HTML = '<a href="/product/DS-2CD1321G0-I-28">...</a>'
RESULT = "/product/DS-2CD1321G0-I-28" ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL
```

---

## üîÑ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –í PIPELINE (SuppliersPipeline)

```
–í—ã–≤–æ–¥–∏–º –¢–û–õ–¨–ö–û —Ç–æ–≤–∞—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—Ç –í–°–ï —É—Å–ª–æ–≤–∏—è:
1. ‚úÖ –ï—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ (–ù–∞–∑–≤–∞_–ø–æ–∑–∏—Ü—ñ—ó)
2. ‚úÖ –ï—Å—Ç—å —Ü–µ–Ω–∞ (–¶—ñ–Ω–∞) –∏ —Ü–µ–Ω–∞ > 0
3. ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å = "–í –Ω–∞–ª–∏—á–∏–∏" (–∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ badge)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í prom_import.csv ‚Üí —Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–æ–π –ò –≤ –Ω–∞–ª–∏—á–∏–∏
- ‚ùå –ù–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º ‚Üí —Ç–æ–≤–∞—Ä—ã –±–µ–∑ —Ü–µ–Ω—ã –ò–õ–ò –Ω–µ –≤ –Ω–∞–ª–∏—á–∏–∏
- ‚úÖ –°—á–µ—Ç—á–∏–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ spider

---

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ spider

### `_clean_price(price_str)`
–û—á–∏—â–∞–µ—Ç —Ü–µ–Ω—É: —É–¥–∞–ª—è–µ—Ç –ø—Ä–æ–±–µ–ª—ã, —Å–∏–º–≤–æ–ª—ã –≤–∞–ª—é—Ç—ã, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–∞–ø—è—Ç—É—é –≤ —Ç–æ—á–∫—É
```python
INPUT: "2&nbsp;537 –≥—Ä–Ω" ‚Üí "2537–≥—Ä–Ω"
OUTPUT: "2537.0"
```

### `_normalize_availability(availability)`
–ú–∞–ø–ø–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ:
- "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" ‚Üí "–í –Ω–∞–ª–∏—á–∏–∏" ‚úÖ
- "–ü—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" ‚Üí "–ü–æ–¥ –∑–∞–∫–∞–∑"
- "–ù–µ–º–∞—î" ‚Üí "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏"
- –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí "–£—Ç–æ—á–Ω—è–π—Ç–µ"

### `_generate_product_code(response)`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–¥ —Ç–æ–≤–∞—Ä–∞:
```python
–°—á–µ—Ç—á–∏–∫: 200000, 200001, 200002, ...
–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Å–∏–º–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
```

### `_extract_manufacturer_from_url(url)`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ URL –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
```python
URL: "https://viatec.ua/catalog/cameras/proizvoditel:hikvision;page:1"
‚Üí –ò–∑–≤–ª–µ–∫–∞–µ–º: "hikvision"
‚Üí –ú–∞–ø–ø–∏—Ä—É–µ–º: "Hikvision"
```

### `_extract_specifications(response)`
–ü–∞—Ä—Å–∏—Ç —Ç–∞–±–ª–∏—Ü—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:
```
–°–µ–ª–µ–∫—Ç–æ—Ä: div.card-tabs__characteristic-content table tbody tr
–ü–æ–ª—è: –ù–∞–∑–≤–∞_–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏_1, –ó–Ω–∞—á–µ–Ω–Ω—è_–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏_1, etc.
–ú–∞–∫—Å: 30 —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
```

---

## üìä –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞

### ‚ùå –¢–æ–≤–∞—Ä –ù–ï –≤ –Ω–∞–ª–∏—á–∏–∏ (–ü–†–û–ü–£–°–ö–ê–ï–ú)
```
–ù–∞–∑–≤–∞–Ω–∏–µ: "DS-2CD1321G0-I"
–¶–µ–Ω–∞: "2537"
–°—Ç–∞—Ç—É—Å: "–ü—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" (–ü–æ–¥ –∑–∞–∫–∞–∑)
‚Üì
Pipeline –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä, –ª–æ–≥–∏—Ä—É–µ—Ç: "‚è≠Ô∏è  –¢–æ–≤–∞—Ä –Ω–µ –≤ –Ω–∞–ª–∏—á–∏–∏"
‚Üì
‚ùå –ù–ï –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ CSV
```

### ‚úÖ –¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –µ—Å—Ç—å —Ü–µ–Ω–∞ (–ó–ê–ü–ò–°–´–í–ê–ï–ú)
```
–ù–∞–∑–≤–∞–Ω–∏–µ: "DS-2CD1321G0-I"
–¶–µ–Ω–∞: "2537"
–°—Ç–∞—Ç—É—Å: "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ" ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è ‚Üí "–í –Ω–∞–ª–∏—á–∏–∏"
‚Üì
Pipeline –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–≤–∞—Ä
‚Üì
‚úÖ –ó–ê–ü–ò–°–´–í–ê–ï–¢–°–Ø –≤ prom_import.csv (—Ä–æ–∑–Ω–∏—Ü–∞)
```

### ‚ùå –¢–æ–≤–∞—Ä –±–µ–∑ —Ü–µ–Ω—ã (–ü–†–û–ü–£–°–ö–ê–ï–ú)
```
–ù–∞–∑–≤–∞–Ω–∏–µ: "DS-2CD1321G0-I"
–¶–µ–Ω–∞: "" (–ø—É—Å—Ç–æ)
–°—Ç–∞—Ç—É—Å: "–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ"
‚Üì
Pipeline –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¶—ñ–Ω–∞: FAILED
‚Üì
‚ùå –ù–ï –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ CSV
```

---

## üîç –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

### Scrapy Shell
```bash
scrapy shell "https://viatec.ua/product/DS-2CD1321G0-I-28"
```

```python
>>> response.css("h1::text").get()
'DS-2CD1321G0-I 2–ú–ü (2.8–º–º) IP –≤—ñ–¥–µ–æ–∫–∞–º–µ—Ä–∞ Hikvision'

>>> response.css("div.card-header__card-price-new::text").get()
'2\xa0537'

>>> response.css("div.card-header__card-status-badge::text").get()
'–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ'

>>> response.css("img.card-header__card-images-image::attr(src)").getall()
['/upload/images/prod/2024-06/DS-2CD1321G0-I.webp']

>>> response.css("div.card-tabs__characteristic-content table tbody tr")
[<Selector>, <Selector>, ...]
```

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ spider –≤—ã–≤–æ–¥–∏—Ç—Å—è:
```
‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ —Ä–æ–∑–Ω–∏—Ü—ã: X —Ç–æ–≤–∞—Ä–æ–≤
‚úÖ –ó–∞–ø–∏—Å–∞–Ω–æ –¥–∏–ª–µ—Ä–∞: Y —Ç–æ–≤–∞—Ä–æ–≤  
‚è≠Ô∏è  –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ: Z —Ç–æ–≤–∞—Ä–æ–≤
```

---

## üìù –§–∞–π–ª—ã –≤—ã–≤–æ–¥–∞

| –§–∞–π–ª | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ | –§–∏–ª—å—Ç—Ä |
|------|-----------|--------|
| `prom_import.csv` | –†–æ–∑–Ω–∏—á–Ω—ã–µ —Ü–µ–Ω—ã (UAH) | –¶–µ–Ω–∞ > 0 –ò –ù–∞—è–≤–Ω—ñ—Å—Ç—å = "–í –Ω–∞–ª–∏—á–∏–∏" |
| `prom_diler_import.csv` | –î–∏–ª–µ—Ä—Å–∫–∏–µ —Ü–µ–Ω—ã (USD) | –¶–µ–Ω–∞ > 0 –ò –ù–∞—è–≤–Ω—ñ—Å—Ç—å = "–í –Ω–∞–ª–∏—á–∏–∏" |

–û–±–∞ —Ñ–∞–π–ª–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤: `C:\Users\stalk\Documents\Prom\`
